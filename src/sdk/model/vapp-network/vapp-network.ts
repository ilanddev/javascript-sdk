import { Iland } from '../../iland';
import { AbstractNetwork } from '../internal-network/abstract-network';
import { VappNetworkJson } from './__json__/vapp-network-json';
import { EntityType } from '../common/__json__/entity-type';
import { Task, TaskJson } from '../task';
import { VappNetworkUpdateRequest } from './vapp-network-update-request';

/**
 * vApp Network.
 */
export class VappNetwork extends AbstractNetwork {

  constructor(_json: VappNetworkJson) {
    super(_json);
  }

  /**
   * Gets an vApp network by UUID.
   * @param uuid vApp network UUID
   * @returns {Promise<VappNetwork>} promise that resolves with the vApp network
   */
  static async getVappNetwork(uuid: string): Promise<VappNetwork> {
    return Iland.getHttp().get(`/vapp-networks/${uuid}`).then((response) => {
      const json = response.data as VappNetworkJson;
      return new VappNetwork(json);
    });
  }

  /**
   * Gets the entity type.
   * @returns {EntityType}
   */
  get entityType(): EntityType {
    return 'IAAS_VAPP_NETWORK';
  }

  /**
   * Gets the UUID of the vApp that the network is associated with.
   * @returns {string} vApp UUID
   */
  get vappUuid(): string | null {
    return (this._json as VappNetworkJson).vapp_uuid;
  }

  /**
   * If this is a NAT Routed network, gets the external IP of the router for the vApp Network edge gateway.
   * @returns {string} IP address
   */
  get routerExternalIp(): string {
    return (this._json as VappNetworkJson).router_external_ip;
  }

  /**
   * Gets the raw JSON object from the API.
   * @returns {VappNetworkJson} the API __json__ object
   */
  get json(): VappNetworkJson {
    return Object.assign({}, this._json as VappNetworkJson);
  }

  /**
   * Refreshes the vApp network data by retrieving it from the API again.
   * @returns {Promise<VappNetwork>} promise that resolves with this object
   */
  async refresh(): Promise<VappNetwork> {
    return Iland.getHttp().get(`/vapp-networks/${this.uuid}`).then((response) => {
      this._json = response.data as VappNetworkJson;
      return this;
    });
  }

  /**
   * Remove a network from the given Vapp.
   * @returns {Promise<Task>} promise Promise that resolves with a Task
   */
  /* istanbul ignore next: autogenerated */
  async removeNetworkFromVapp(): Promise<Task> {
    return Iland.getHttp().delete(`/vapp-networks/${this.uuid}`).then((response) => {
      const json = response.data as TaskJson;
      return new Task(json);
    });
  }

  /**
   * Update a vApp network's properties. Note that vCloud Director changes the
   * UUID of the network when it is updated.
   * @param {VappNetworkUpdateRequest} vappNetwork VappNetwork update request
   * @returns {Promise<Task>} promise Promise that resolves with a Task
   */
  /* istanbul ignore next: autogenerated */
  async updateVappNetwork(vappNetwork: VappNetworkUpdateRequest): Promise<Task> {
    return Iland.getHttp().put(`/vapp-networks/${this.uuid}`, vappNetwork.json).then((response) => {
      const json = response.data as TaskJson;
      return new Task(json);
    });
  }

}
